@inherits Maklak.Web.Helpers.HelperPage
@using System.Web.Mvc;
@using System.Web.Mvc.Html;

@helper SuggestionPopUp()
{

    <style type="text/css">
        .closeSGStripCell {
            width: 100%;
        }

        .xSGCell {
            color: Red;
            cursor: pointer;
            padding-right: 3px;
        }

        .sgContentTable {
            width: 100%;
            height: 100%;
        }

        .sgTopRow {
            font-size: 7;
            background-color: Gray;
            margin-bottom: 0px;
            margin-top: 0px;
            padding-bottom: 0px;
            padding-top: 0px;
        }

        .sgContentRow {
            height: 100%;
        }

        .sgContentCell {
            vertical-align: top;
        }

        .suggestionDIV {
            display: none;
            position: absolute;
            background-color: White;
            border-style: solid;
            border-width: 1px;
            border-color: Black;
        }
    </style>

    <div class="suggestionDIV" id="suggestiontPopUp">
        <table class="sgContentTable">

            <tr class="sgTopRow">
                <td class="closeSGStripCell">&nbsp;</td>
                <td class="xSGCell rightAlign" onclick="Suggest.HideSuggestion()">x</td>
            </tr>

            <tr class="sgContentRow">
                <td class="sgContentCell" colspan="2"><div id="suggestionContent"></div></td>
            </tr>

        </table>
    </div>

    <script type="text/javascript">

        function Suggest() { }

        Suggest.currentInput;

        Suggest.HideSuggestion = function (event) {

            var suggestElement = $("#suggestiontPopUp");
            var se = document.getElementById("suggestiontPopUp")

            if (suggestElement.css("display") == "none")
                return;

            var clientRect = se.getBoundingClientRect();
            var inputRect = Suggest.currentInput.getBoundingClientRect();


            if (event != 'undefined' && event != null) {
                //Если мышь в эелементе ввода или над окном подсказки - выход
                if (Suggest.pointInRect(event.clientX, event.clientY, clientRect) || Suggest.pointInRect(event.clientX, event.clientY, inputRect))
                    return;
            }

            suggestElement.hide();
            Global.currentPopUpHide = null;
            Suggest.currentInput = null;


        }

       Suggest.pointInRect = function(x, y, rect) {
            if ((x >= rect.left && x <= rect.right) && (y >= rect.top && y <= rect.bottom))
                return true;

            return false;
        }

        Suggest.ShowSuggestion = function (inputElement, action, controller) {

            Suggest.currentInput = inputElement;
            var suggestElement = $("#suggestiontPopUp");
            var suggestContentElement = $("#suggestionContent");
            var inputID = "#" + inputElement.id;
            var input = $(inputID);
            if (suggestElement.css("display") == "none") {

                var clientRect = inputElement.getBoundingClientRect();
                var scrl = PopUp.defScroll();
                suggestElement.css('left', clientRect.left + scrl.x);
                suggestElement.css('top', clientRect.bottom + scrl.y);
                //suggestElement.height(inputElement.clientHeight * 7);
                suggestElement.width(inputElement.clientWidth);

            }

            function fillSuggestion(data) {

                if (data == '') {
                    suggestElement.hide();
                    Global.currentPopUpHide = null;
                    Suggest.currentInput = null;
                    return;
                }

                suggestContentElement.html(data);
                Global.currentPopUpHide = Suggest.HideSuggestion;
                suggestElement.show();
            }

            var url = GetURL() + '/' + controller + '/' + action;

            $.post(url, input.serialize(), fillSuggestion);


        }

         Suggest.SetSuggestion=function(suggestionValue) {
             //alert(Suggest.currentInput);
             Suggest.currentInput.value = suggestionValue;

             Suggest.HideSuggestion();
          }

    </script>

}