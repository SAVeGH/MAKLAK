@model Maklak.Client.Models.FractalModel

@{

	string fractalPanelKey = this.Model.ParentKey;
	string controlFormId = string.Format("Control_{0}", fractalPanelKey);

	string controlFormTargetID = string.Format("FractalPanel_{0}", fractalPanelKey);
	string fractalPanelRecursiveAction = this.Model.FractalPanelAction;
	string keyName = this.Model.Key + "_KEY";
	

	RouteValueDictionary routControlValues = new RouteValueDictionary();
	routControlValues.Add("Key", fractalPanelKey); /* название модели для Control совпадает с ключом текущей модели*/

	using (Ajax.BeginForm(fractalPanelRecursiveAction, // запрос уходит на FractalPanel
						  null,
						  new AjaxOptions()
						  {
							  HttpMethod = "POST",
							  InsertionMode = InsertionMode.Replace,
							  UpdateTargetId = controlFormTargetID // id обновляемого элемента
																   //,
																   //OnComplete = callbackEvent
						  },
						  new { id = controlFormId }))
	{
        @*Control*@
        @Html.Action(this.Model.ControlAction, this.Model.ControlController, routControlValues)

        @*@Html.HiddenFor(m => m.SID)
        @Html.HiddenFor(m => m.Key, new { id = keyName })*@

		<input type="hidden" name="Key" value="@this.Model.Key" id="@keyName" /> @*ключь с которым происходит submit формы контрола*@
		<input type="hidden" name="SID" value="@this.Model.SID" />
	}
}
